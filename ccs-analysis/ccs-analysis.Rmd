---
title: "CCS Knowledge Map Results"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true

---

```{r setup, include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(DT)
potential_fakes <- c(316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 327, 329,
                     330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 342, 343, 344, 345, 
                     346, 348, 349, 350, 351, 352, 353, 354, 355, 356, 358, 359, 360, 361, 
                     362, 363, 364, 365, 366, 367, 369, 370, 371, 372, 373, 374, 376, 378, 379, 380,
                     381, 382, 383, 384, 385, 389, 390, 391, 392, 392, 393, 395, 396, 397, 398, 399)


# Import all datasets
tree_survey <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/tree-canopy/tree_survey.csv")
tree_map <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/tree-canopy/tree_map.csv")
heat_survey <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/urban-heat/heat_survey.csv")
heat_map <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/urban-heat/heat_map.csv")
air_survey <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/air-quality/air_survey.csv")
air_map <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/air-quality/air_map.csv")
ej_survey <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/ej-survey/ej_survey.csv")
ej_report <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/ej-report/ej_report.csv")

# Questions - https://docs.google.com/document/d/1hl5Eb66a8j7TDE1EzzOF4eUjUguet5dMsw7UJydr_uY/edit

# Cleaning functions
clean_matrix <- function(dataframe, column_name) {
  cleaned_data <- dataframe %>%
    separate_rows({{ column_name }}, sep = "; ") %>%
    separate({{ column_name }}, into = c("question", "answer"), sep = " - ")
  cleaned_data$answer <- as.factor(cleaned_data$answer)
  
  summary_data <- cleaned_data %>%
    group_by(question, answer) %>%
    summarise(n = n()) %>%
    mutate(freq = round((n / sum(n)),digits=2     )*100)
  
  return(summary_data)
}


clean_box <- function(data, response) {
  summary_data <- data %>%
    group_by({{ response }}) %>%
    summarise(count = n()) %>%
    mutate(freq = round(count / sum(count), digits = 2)*100)
  
  return(summary_data)
}


clean_multi <- function(data, response) {
  cleaned_data <- data %>%
    separate_rows({{ response }}, sep = "; ")
  
  summary_data <- cleaned_data %>%
    group_by({{ response }}) %>%
    summarise(count = n()) %>%
    mutate(freq = round(count / sum(count), digits = 2) * 100)
  
  return(summary_data)
}
```

# Project Overview


# Local Government Survey Descriptions

## Air Quality (AQ)

```{r aq-setup, include=FALSE, cache=TRUE}

# Run all analysis for the AQ survey here

```

- Description of survey and the questions asked


### AQ Analysis
```{r aq-analysis-report, echo=TRUE}

# Report the analysis of survey items here

```

### AQ Map
```{r aq-map-report, echo=TRUE}

# Report the analysis of map items here

```


## Urban Heat (UH)
```{r uh-setup, include=FALSE, cache=TRUE}

# Run all analysis for the AQ survey here

```

- Description of survey and the questions asked

### UH Analysis
```{r uh-analysis-report, echo=TRUE}

# Report the analysis of survey items here

```

### UH Map
```{r uh-map-report, echo=TRUE}

# Report the analysis of survey items here

```

## Tree Canopies (TC)
```{r tc-setup, include=FALSE, cache=TRUE}
new_names <- c(
  "past_years","importance_of_benefits","agreement_about_trees","neighborhood_street_trees","tree_infrastructure_damage","tree_quality_life","tree_values","areas_needing_trees","preferred_tree_types","tree_goals","tree_support")

# Selecting the columns to rename by their position using the colnames function
colnames(tree_survey)[5:15] <- new_names

# OVERALL QUESTION SUMMARY
tree_experiences_overtime <- clean_matrix(tree_survey,"past_years")
tree_benefits <- clean_matrix(tree_survey,"importance_of_benefits")
tree_beliefs <- clean_matrix(tree_survey,"agreement_about_trees")
trees_home <- clean_box(tree_survey,neighborhood_street_trees)
tree_damage <- clean_multi(tree_survey,tree_infrastructure_damage)
tree_value <- clean_multi(tree_survey,tree_values)
tree_area_need <- clean_multi(tree_survey,areas_needing_trees)
tree_types <- clean_multi(tree_survey,preferred_tree_types)
tree_goals <- clean_multi(tree_survey,tree_goals)
tree_support <- clean_multi(tree_survey,tree_support)


# Run all analysis for the AQ survey here

```

- Description of survey and the questions asked


### TC Analysis

#### Rate the level of agreement with the following statement: "Over the past 10 years,..." 

```{r tc-analysis-report, echo=TRUE}
datatable(tree_experiences_overtime)
# Report the analysis of survey items here
```

#### Please rate the importance of each of the following benefits of trees:

```{r}
datatable(tree_benefits)
```

#### Please rate your level of agreement with each of the following statements:

```{r}
datatable(tree_beliefs)
```

#### Does your neighborhood have planted street trees (Street trees- Any tree that is planted in the public right-of-way near and along the roadways which shade sidewalks and grows over the road)

```{r}
datatable(trees_home)
```

#### Have you observed tree-related damage to infrastructure in your neighborhood? Select all that apply
```{r}
datatable(tree_damage)
```

#### How do trees impact your quality of life and your community?
```{r}
# OPEN ENDED NEED TO PROCESS USING TEXT MINING
```

#### Which aspects of trees do you value? Select all that apply.

```{r}
datatable(tree_value)
```

#### What general areas in your community need more trees? Select all that apply.

```{r}
datatable(tree_area_need)
```

#### What type of trees would you like to see planted? Check all that apply.

```{r}
datatable(tree_area_need)
```

#### What tree-related goals would you like to see prioritized? Select up to 3

```{r}
datatable(tree_goals)
```

#### If you are interested in helping to support the Town's tree-planting efforts, which of the following activities would you be willing to participate in? Select all that apply.

```{r}
datatable(tree_support)

```

### TC Map
```{r tc-map-report, echo=TRUE}

# Report the analysis of survey items here

```


# Environmental Justics Survey Descriptions

## EJ Stories 
```{r ej-stories-setup, include=FALSE, cache=TRUE}

```

- Description of survey and the questions asked


## EJ Solutions
```{r ej-solutions-setup, include=FALSE, cache=TRUE}

```

- Description of survey and the questions asked


# Meta Summary


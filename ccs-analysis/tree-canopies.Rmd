---
title: "CCS Knowledge Map Results: Tree Canopies"
author: "Corey Jackson"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true

---

```{r setup, include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(DT)

# Import all datasets
tree_survey <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/tree-canopy/tree_survey.csv")
tree_map <- read.csv("/Volumes/cbjackson2/ccs-knowledge/ccs-data/tree-canopy/tree_map.csv")

# Questions - https://docs.google.com/document/d/1hl5Eb66a8j7TDE1EzzOF4eUjUguet5dMsw7UJydr_uY/edit

# Cleaning functions
clean_matrix <- function(dataframe, column_name) {
  cleaned_data <- dataframe %>%
    separate_rows({{ column_name }}, sep = "; ") %>%
    separate({{ column_name }}, into = c("question", "answer"), sep = " - ")
  cleaned_data$answer <- as.factor(cleaned_data$answer)
  
  summary_data <- cleaned_data %>%
    group_by(question, answer) %>%
    summarise(n = n()) %>%
    mutate(freq = round((n / sum(n)),digits=2     )*100)
  
  return(summary_data)
}


clean_box <- function(data, response) {
  summary_data <- data %>%
    group_by({{ response }}) %>%
    summarise(count = n()) %>%
    mutate(freq = round(count / sum(count), digits = 2)*100)
  
  return(summary_data)
}


clean_multi <- function(data, response) {
  cleaned_data <- data %>%
    separate_rows({{ response }}, sep = "; ")
  
  summary_data <- cleaned_data %>%
    group_by({{ response }}) %>%
    summarise(count = n()) %>%
    mutate(freq = round(count / sum(count), digits = 2) * 100)
  
  return(summary_data)
}
```

# Project Overview

## Tree Canopies (TC)
```{r tc-setup, include=FALSE, cache=TRUE}
new_names <- c(
  "past_years","importance_of_benefits","agreement_about_trees","neighborhood_street_trees","tree_infrastructure_damage","tree_quality_life","tree_values","areas_needing_trees","preferred_tree_types","tree_goals","tree_support")

# Selecting the columns to rename by their position using the colnames function
colnames(tree_survey)[5:15] <- new_names

# OVERALL QUESTION SUMMARY
tree_experiences_overtime <- clean_matrix(tree_survey,"past_years")
tree_benefits <- clean_matrix(tree_survey,"importance_of_benefits")
tree_beliefs <- clean_matrix(tree_survey,"agreement_about_trees")
trees_home <- clean_box(tree_survey,neighborhood_street_trees)
tree_damage <- clean_multi(tree_survey,tree_infrastructure_damage)
tree_value <- clean_multi(tree_survey,tree_values)
tree_area_need <- clean_multi(tree_survey,areas_needing_trees)
tree_types <- clean_multi(tree_survey,preferred_tree_types)
tree_goals <- clean_multi(tree_survey,tree_goals)
tree_support <- clean_multi(tree_survey,tree_support)

# Run all analysis for the AQ survey here

```

- Description of survey and the questions asked


## Tree Canopies Analysis

### Rate the level of agreement with the following statement: "Over the past 10 years,..." 

```{r tc-analysis-report, echo=TRUE}
datatable(tree_experiences_overtime)
# Report the analysis of survey items here
```

### Please rate the importance of each of the following benefits of trees:

```{r}
datatable(tree_benefits)
```

### Please rate your level of agreement with each of the following statements:

```{r}
datatable(tree_beliefs)
```

### Does your neighborhood have planted street trees (Street trees- Any tree that is planted in the public right-of-way near and along the roadways which shade sidewalks and grows over the road)

```{r}
datatable(trees_home)
```

### Have you observed tree-related damage to infrastructure in your neighborhood? Select all that apply
```{r}
datatable(tree_damage)
```

### How do trees impact your quality of life and your community?
```{r}
# OPEN ENDED NEED TO PROCESS USING TEXT MINING
```

### Which aspects of trees do you value? Select all that apply.
```{r}
datatable(tree_value)
```


### What general areas in your community need more trees? Select all that apply.

```{r}
datatable(tree_area_need)
```

### What type of trees would you like to see planted? Check all that apply.

```{r}
datatable(tree_area_need)
```

### What tree-related goals would you like to see prioritized? Select up to 3

```{r}
datatable(tree_goals)
```

### If you are interested in helping to support the Town's tree-planting efforts, which of the following activities would you be willing to participate in? Select all that apply.

```{r}
datatable(tree_support)

```

## TC Map
```{r tc-map-report, echo=TRUE}

# Report the analysis of survey items here

```

# Place Analysis 
```{r}

# The EJ dataframe has descriptions of their neighborhoods, we could examine perceptions and solutions. We might need to highlight contrasting (interesting) insights. Depending on match, we could make argument for more knowledge about harms

tree_survey <- tree_survey %>%
  mutate(
    county_code = sprintf("%03d", as.integer(county_fips)),
    census_tract = sprintf("%06d", as.integer(census_tract)),
    census_block = sprintf("%04d", as.integer(census_block)),
    census_tract_full = paste0(state_fips, county_code, census_tract),
    census_block_full = paste0(state_fips, county_code, census_tract, census_block),
  )


# Import SVI 
svi_tract <- read.csv("/Volumes/cbjackson2/ccs-knowledge/census-data/svi/svi-wi-tract.csv")

# Import EJ40
eji <- read.csv("//Volumes/cbjackson2/ccs-knowledge/census-data/environmental/eji-wisconsin.csv")

#https://www.atsdr.cdc.gov/placeandhealth/eji/indicators.html
ejm <- read.csv("//Volumes/cbjackson2/ccs-knowledge/census-data/environmental/ejm-wisconsin.csv")


```


# Meta Summary

